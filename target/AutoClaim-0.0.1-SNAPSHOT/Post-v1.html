<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>

<body>
    <form id="updateStudentForm">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required><br>
        <label for="age">Age:</label>
        <input type="number" id="age" name="age" required><br>
        <label for="major">Major:</label>
        <input type="text" id="major" name="major" required><br>
        <input type="submit" value="Update Student">
    </form>
    <p id="validationMessage"></p>
    <p id="confirmationMessage"></p>
    <script>
        $("#updateStudentForm").submit(function (e) {
            e.preventDefault();

            // Client-side validation
            var name = $("#name").val();
            var age = $("#age").val();

            if (name.length === 0 || age.length === 0) {
                $("#validationMessage").text("Name and age cannot be empty.");
                return;
            }

            if (name.length >= 20) {
                $("#validationMessage").text("Name should be less than 20 characters.");
                return;
            }

            if (isNaN(age) || age < 13 || age > 89) {
                $("#validationMessage").text("Age should be an integer between 13 and 89.");
                return;
            }

            // If all validations pass, proceed with the AJAX call
            var studentData = {
                name: name,
                age: age,
                major: $("#major").val()
            };

            $.ajax({
                url: "http://localhost:8080/Silva_Test3/students",
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(studentData),
                success: function (result) {
                    $("#validationMessage").text("");
                    $("#confirmationMessage").text("Student updated successfully!");
                    // Additional logic to list entire students below the form
                    fetchStudents();
                },
                error: function (error) {
                    if (error.status === 409) {
                        $("#validationMessage").text("Student with the same name already exists.");
                    } else {
                        console.log(error);
                    }
                }
            }
   
        );
         // Function to fetch and display existing students
    function fetchStudents() {
        $.ajax({
            url: "http://localhost:8080/Silva_Test3/students",
            type: 'GET',
            success: function (students) {
                displayStudents(students);
            },
            error: function (error) {
                console.log(error);
            }
        });
    }
    

    // Function to display students in a table
    function displayStudents(students) {
        var tableBody = $("#studentsTable tbody");
        tableBody.empty(); // Clear existing table rows
        students.forEach(function (student) {
            var row = "<tr><td>" + student.id + "</td><td>" + student.name + "</td><td>" + student.age + "</td><td>" + student.major + "</td></tr>";
            tableBody.append(row);
        });
    }
    })
    
      ;
</script>

</body>
</html>
    </script>
</body>

</html>
